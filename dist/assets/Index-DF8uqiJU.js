const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B3CWdENx.js","assets/index-DUy0cMb6.js","assets/index-B-8b3tac.css"])))=>i.map(i=>d[i]);
import{_ as ee,r as y,l as ae,n as le,q as V,a as c,c as x,o as w,e as g,b as a,w as t,x as te,d as i,B as L,F as O,h as R,y as n,z as oe,j as U,t as s,E as re}from"./index-DUy0cMb6.js";const ne={class:"salary-calculation-container"},se={class:"card-header"},de={class:"filter-container"},ue={class:"net-salary"},ie={class:"pagination-container"},ce={key:0,class:"salary-detail"},pe={__name:"Index",setup(_e){const f=y(!1),E=y([]),D=y([]),S=y([]),k=y(1),C=y(10),z=y(0),d=ae({month:new Date().toISOString().slice(0,7),salaryGroupId:"",employeeId:""}),A=y(!1),u=y(null);le(()=>{T(),G(),h()});const T=async()=>{try{const{default:o}=await V(async()=>{const{default:r}=await import("./index-B3CWdENx.js");return{default:r}},__vite__mapDeps([0,1,2])),e=await o.get("/salary-groups");e.success?E.value=Array.isArray(e.data)?e.data.filter(r=>r&&r.id!==void 0&&r.name!==void 0):[]:(c.error(e.error||"加载薪资组失败"),E.value=[])}catch(o){console.error("加载薪资组失败:",o),c.error("加载薪资组失败")}},G=async()=>{try{const{default:o}=await V(async()=>{const{default:r}=await import("./index-B3CWdENx.js");return{default:r}},__vite__mapDeps([0,1,2])),e=await o.get("/employee/list");e.success?D.value=Array.isArray(e.data)?e.data.filter(r=>r&&r.id!==void 0&&r.name!==void 0):[]:(c.error(e.error||"加载员工失败"),D.value=[])}catch(o){console.error("加载员工失败:",o),c.error("加载员工失败")}},h=async()=>{f.value=!0;try{const{default:o}=await V(async()=>{const{default:I}=await import("./index-B3CWdENx.js");return{default:I}},__vite__mapDeps([0,1,2])),e={month:d.month,salary_group_id:d.salaryGroupId,employee_id:d.employeeId,page:k.value,page_size:C.value},r=await o.get("/salary/history",{params:e});r.success?(S.value=r.data.items||[],z.value=r.data.total||0):(c.error(r.error||"获取薪资数据失败"),S.value=[],z.value=0),f.value=!1}catch(o){console.error("加载薪资数据失败:",o),c.error("加载薪资数据失败"),f.value=!1}},P=()=>{d.month=new Date().toISOString().slice(0,7),d.salaryGroupId="",d.employeeId="",h()},Y=()=>{re.confirm(`确定要计算${d.month}的薪资数据吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{f.value=!0;try{const{default:o}=await V(async()=>{const{default:r}=await import("./index-B3CWdENx.js");return{default:r}},__vite__mapDeps([0,1,2])),e=await o.post("/salary/calculate",{month:d.month,salary_group_id:d.salaryGroupId,employee_id:d.employeeId});e.success?(c.success("薪资计算成功"),h()):c.error(e.error||"薪资计算失败"),f.value=!1}catch(o){console.error("薪资计算失败:",o),c.error("薪资计算失败"),f.value=!1}}).catch(()=>{})},$=o=>{u.value=o,A.value=!0},M=o=>{try{f.value=!0,c.info(`正在准备导出${o.employee_name}的薪资单...`),V(async()=>{const{default:e}=await import("./index-B3CWdENx.js");return{default:e}},__vite__mapDeps([0,1,2])).then(({default:e})=>{e.get("/salary/export",{params:{id:o.id},responseType:"blob"}).then(r=>{const I=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),b=window.URL.createObjectURL(I),v=document.createElement("a");v.href=b,v.setAttribute("download",`薪资单_${o.employee_name}_${d.month}.xlsx`),document.body.appendChild(v),v.click(),window.URL.revokeObjectURL(b),document.body.removeChild(v),c.success(`${o.employee_name}的薪资单导出成功`),f.value=!1}).catch(r=>{console.error("导出薪资单失败:",r),c.error("导出薪资单失败，请稍后重试"),f.value=!1})})}catch(e){console.error("导出薪资单失败:",e),c.error("导出薪资单失败"),f.value=!1}},p=o=>o==null?"0.00":`¥${parseFloat(o).toFixed(2)}`,F=o=>{C.value=o,h()},j=o=>{k.value=o,h()};return(o,e)=>{const r=i("el-button"),I=i("el-date-picker"),b=i("el-form-item"),v=i("el-option"),B=i("el-select"),N=i("el-form"),_=i("el-table-column"),q=i("el-tag"),H=i("el-table"),J=i("el-pagination"),K=i("el-card"),m=i("el-descriptions-item"),Q=i("el-descriptions"),W=i("el-dialog"),X=oe("loading");return w(),x("div",ne,[e[12]||(e[12]=g("h1",null,"薪资计算",-1)),a(K,{class:"main-card"},{header:t(()=>[g("div",se,[e[7]||(e[7]=g("span",null,"薪资计算",-1)),a(r,{type:"primary",onClick:Y},{default:t(()=>e[6]||(e[6]=[n("计算薪资")])),_:1})])]),default:t(()=>[g("div",de,[a(N,{inline:!0,model:d,class:"form-inline"},{default:t(()=>[a(b,{label:"计算月份"},{default:t(()=>[a(I,{modelValue:d.month,"onUpdate:modelValue":e[0]||(e[0]=l=>d.month=l),type:"month",placeholder:"选择月份",format:"YYYY年MM月","value-format":"YYYY-MM"},null,8,["modelValue"])]),_:1}),a(b,{label:"薪资组"},{default:t(()=>[a(B,{modelValue:d.salaryGroupId,"onUpdate:modelValue":e[1]||(e[1]=l=>d.salaryGroupId=l),placeholder:"选择薪资组"},{default:t(()=>[o.item&&o.item.id!==void 0&&o.item.name!==void 0?(w(!0),x(O,{key:0},R(E.value,l=>(w(),U(v,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128)):L("",!0)]),_:1},8,["modelValue"])]),_:1}),a(b,{label:"员工"},{default:t(()=>[a(B,{modelValue:d.employeeId,"onUpdate:modelValue":e[2]||(e[2]=l=>d.employeeId=l),placeholder:"选择员工",clearable:""},{default:t(()=>[o.item&&o.item.id!==void 0&&o.item.name!==void 0?(w(!0),x(O,{key:0},R(D.value,l=>(w(),U(v,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128)):L("",!0)]),_:1},8,["modelValue"])]),_:1}),a(b,null,{default:t(()=>[a(r,{type:"primary",onClick:h},{default:t(()=>e[8]||(e[8]=[n("查询")])),_:1}),a(r,{onClick:P},{default:t(()=>e[9]||(e[9]=[n("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),te((w(),U(H,{data:S.value,border:"",style:{width:"100%"}},{default:t(()=>[a(_,{prop:"employee_name",label:"员工姓名",width:"120"}),a(_,{prop:"employee_number",label:"工号",width:"100"}),a(_,{prop:"department",label:"部门",width:"120"}),a(_,{prop:"position",label:"职位",width:"120"}),a(_,{prop:"base_salary",label:"基本工资",width:"120"},{default:t(l=>[n(s(p(l.row.base_salary)),1)]),_:1}),a(_,{prop:"attendance_deduction",label:"考勤扣款",width:"120"},{default:t(l=>[n(s(p(l.row.attendance_deduction)),1)]),_:1}),a(_,{prop:"bonus",label:"奖金",width:"120"},{default:t(l=>[n(s(p(l.row.bonus)),1)]),_:1}),a(_,{prop:"social_security",label:"社保",width:"120"},{default:t(l=>[n(s(p(l.row.social_security)),1)]),_:1}),a(_,{prop:"tax",label:"个税",width:"120"},{default:t(l=>[n(s(p(l.row.tax)),1)]),_:1}),a(_,{prop:"net_salary",label:"实发工资",width:"120"},{default:t(l=>[g("span",ue,s(p(l.row.net_salary)),1)]),_:1}),a(_,{prop:"status",label:"状态",width:"100"},{default:t(l=>[a(q,{type:l.row.status==="已发放"?"success":"warning"},{default:t(()=>[n(s(l.row.status),1)]),_:2},1032,["type"])]),_:1}),a(_,{label:"操作",width:"150",fixed:"right"},{default:t(l=>[a(r,{type:"primary",size:"small",onClick:Z=>$(l.row)},{default:t(()=>e[10]||(e[10]=[n("详情")])),_:2},1032,["onClick"]),a(r,{type:"success",size:"small",onClick:Z=>M(l.row),disabled:l.row.status!=="已计算"},{default:t(()=>e[11]||(e[11]=[n("导出")])),_:2},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[X,f.value]]),g("div",ie,[a(J,{"current-page":k.value,"onUpdate:currentPage":e[3]||(e[3]=l=>k.value=l),"page-size":C.value,"onUpdate:pageSize":e[4]||(e[4]=l=>C.value=l),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:z.value,onSizeChange:F,onCurrentChange:j},null,8,["current-page","page-size","total"])])]),_:1}),a(W,{modelValue:A.value,"onUpdate:modelValue":e[5]||(e[5]=l=>A.value=l),title:"薪资详情",width:"600px"},{default:t(()=>[u.value?(w(),x("div",ce,[g("h3",null,s(u.value.employee_name)+" - "+s(d.month)+"薪资明细",1),a(Q,{column:1,border:""},{default:t(()=>[a(m,{label:"员工姓名"},{default:t(()=>[n(s(u.value.employee_name),1)]),_:1}),a(m,{label:"工号"},{default:t(()=>[n(s(u.value.employee_number),1)]),_:1}),a(m,{label:"部门"},{default:t(()=>[n(s(u.value.department),1)]),_:1}),a(m,{label:"职位"},{default:t(()=>[n(s(u.value.position),1)]),_:1}),a(m,{label:"基本工资"},{default:t(()=>[n(s(p(u.value.base_salary)),1)]),_:1}),a(m,{label:"考勤扣款"},{default:t(()=>[n(s(p(u.value.attendance_deduction)),1)]),_:1}),a(m,{label:"奖金"},{default:t(()=>[n(s(p(u.value.bonus)),1)]),_:1}),a(m,{label:"社保"},{default:t(()=>[n(s(p(u.value.social_security)),1)]),_:1}),a(m,{label:"个税"},{default:t(()=>[n(s(p(u.value.tax)),1)]),_:1}),a(m,{label:"实发工资"},{default:t(()=>[n(s(p(u.value.net_salary)),1)]),_:1}),a(m,{label:"状态"},{default:t(()=>[n(s(u.value.status),1)]),_:1}),a(m,{label:"计算时间"},{default:t(()=>[n(s(u.value.calculate_time),1)]),_:1})]),_:1})])):L("",!0)]),_:1},8,["modelValue"])])}}},fe=ee(pe,[["__scopeId","data-v-139fdaad"]]);export{fe as default};
